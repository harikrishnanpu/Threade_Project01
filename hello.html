<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,minimal-ui">
  <title>Shop | Minimal E-commerce</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#10141a">
  <style>
    :root {
      --accent: #1d3557; /* Deep blue */
      --bg: #fff;
      --fg: #10141a;
      --muted: #c2c9d6;
      --border: #eeeeee;
      --border-dark: #e1e4ea;
      --border-radius: .7rem;
      --radius-sm: .5em;
      --transition: .18s cubic-bezier(.39,.58,.57,1);
      --product-img-height: 136px;
      --sidebar-width: 92vw;
      --sidebar-max-width: 320px;
      --deal-bg: #f8fafc;
      --shadow: 0 1px 8px 0 rgba(9,16,30,.1);
      --btn-hover: #183253;
      --danger: #e63946;
    }
    html, body {
      font-family: 'Poppins', system-ui, Arial, sans-serif;
      font-size: 15px;
      background: var(--bg);
      color: var(--fg);
      margin: 0;
      min-height: 100%;
      scroll-behavior: smooth;
      font-weight: 400;
      letter-spacing: 0;
      -webkit-font-smoothing: antialiased;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      margin: 0;
      background: var(--bg);
    }
    /* Sticky header */
    header {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 202;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75em 1em;
      box-shadow: var(--shadow);
      height: 3.3rem;
      min-height: 3.3rem;
    }
    .header-title {
      font-size: 1.14em;
      font-weight: 600;
      letter-spacing: -0.5px;
      color: var(--fg);
      flex: 1 1 auto;
      margin: 0;
      padding: 0;
    }
    .header-btn {
      display: inline-flex;
      align-items: center;
      background: none;
      border: none;
      color: var(--accent);
      font-size: 1.8em;
      margin-inline-end: 1px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: color var(--transition);
    }
    .header-btn:active, .header-btn:focus { outline: none; }
    .badge {
      display: inline-block;
      border-radius: 1em;
      padding: 0 0.5em;
      font-size: 0.83em;
      background: var(--muted);
      color: #fff;
      font-weight: 600;
      line-height: 1.5;
    }

    main {
      width: 100%;
      padding-top: 1.2em;
      padding-bottom: 3.5em;
      flex: 1 1 auto;
    }
    .main-row {
      max-width: 1240px;
      margin: 0 auto;
      display: flex;
      gap: 0;
      position: relative;
    }
    @media (max-width: 991px) {
      .main-row { flex-direction: column; }
    }

    /* Sidebar styles */
    aside.shop-sidebar {
      width: var(--sidebar-width);
      max-width: var(--sidebar-max-width);
      background: #fff;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 210;
      box-shadow: 0 4px 24px 0 rgba(16,24,48,0.07);
      border-radius: 0 1em 1em 0;
      padding: 1.05em 1em 2.2em 1em;
      transform: translateX(-110%);
      transition: transform .32s cubic-bezier(.6,.09,.62,1);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      border-right: 1px solid var(--border-dark);
    }
    aside.shop-sidebar.sidebar-open {
      transform: translateX(0);
    }
    @media (min-width: 992px) {
      aside.shop-sidebar {
        position: relative;
        transform: none;
        height: auto;
        z-index: 1;
        max-width: 250px;
        width: 210px;
        border-radius: 1em;
        border: 1px solid var(--border-dark);
        margin-right: 2vw;
        box-shadow: none;
        top: 0;
        left: 0;
      }
      aside.shop-sidebar.sidebar-open { transform: none; }
    }
    .sidebar-backdrop {
      display: block;
      position: fixed;
      inset: 0;
      background: rgba(22,24,48,.25);
      z-index: 209;
      transition: opacity .2s;
      opacity: 1;
    }
    .sidebar-backdrop[hidden] { display:none; opacity:0; }

    .sidebar-close-btn {
      background: none;
      border: none;
      font-size: 2.2em;
      font-weight: 400;
      color: var(--fg);
      opacity: .54;
      margin-bottom: 1em;
      margin-left: auto;
      display: inline-block;
      cursor: pointer;
    }
    .sidebar-search {
      display: flex;
      gap: 0.25em;
      margin-bottom: 1em;
      width: 100%;
    }
    .sidebar-search input[type="text"] {
      flex: 1 1 auto;
      font-size: 1em;
      border: 1.2px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 0.65em 1.15em;
      outline: none;
      background: var(--bg);
      color: var(--fg);
      transition: border-color .2s;
    }
    .sidebar-search input[type="text"]:focus {
      border-color: var(--accent);
    }
    .sidebar-search button {
      font-size: 1.11em;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      padding: 0.68em 1.1em;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition);
      margin-left: 0.2em;
    }
    .sidebar-search button:active { background: var(--btn-hover);}
    .sidebar-section {
      margin-bottom: 1.25em;
      border-bottom: 1px solid var(--border);
      padding-bottom: 1.25em;
      animation: fadeInY .16s;
    }
    .sidebar-title {
      font-size: .98em;
      font-weight: 600;
      color: var(--fg);
      display: flex;
      align-items: center;
      margin: .2em 0 0.8em 0;
      cursor: pointer;
      user-select: none;
      gap: .55em;
    }
    .sidebar-title .collapse-icon {
      font-size: 1.18em;
      display: inline-block;
      transform: rotate(-90deg);
      transition: transform var(--transition);
      margin-right: 2px;
      opacity: .52;
    }
    .sidebar-title.collapsed .collapse-icon { transform: rotate(0deg); }

    .sidebar-list,
    .sidebar-value-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .sidebar-list li {
      margin-bottom: 0.38em;
    }
    .sidebar-list li:last-child { margin-bottom: 0; }
    .sidebar-list a,
    .sidebar-value-list label {
      display: inline-block;
      font-size: 0.99em;
      color: var(--fg);
      background: rgba(0,0,0,.015);
      border-radius: var(--radius-sm);
      padding: .42em 1em;
      border: 1px solid var(--border);
      margin: 1.5px 2.5px;
      transition: background var(--transition), color var(--transition);
      font-weight: 400;
      text-decoration: none;
      cursor: pointer;
      user-select: none;
      vertical-align: middle;
      line-height: 1.22;
    }
    .sidebar-list a.active, .sidebar-list a:focus-visible, .sidebar-list a:hover,
    .sidebar-value-list label.active, .sidebar-value-list label:focus-visible, .sidebar-value-list label:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    .sidebar-value-list label {
      padding: .53em 1.18em;
      margin: 2.5px 2.5px 2.5px 0;
      cursor: pointer;
    }
    .sidebar-value-list input[type="radio"] {
      display: none;
    }
    .sidebar-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3em;
    }
    .sidebar-tags a {
      font-size: 0.98em;
      border-radius: var(--radius-sm);
      background: rgba(0,0,0,.02);
      color: var(--accent);
      border: 1.1px solid var(--border);
      padding: .38em .9em;
      text-decoration: none;
      margin: 2.5px 1px 2.5px 0;
      transition: background var(--transition), border var(--transition), color var(--transition);
    }
    .sidebar-tags a.active, .sidebar-tags a:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    /* Main content */
    .shop-main {
      flex: 1 1 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
    }
    .filters-bar {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 0.65em 0.6em;
      margin-bottom: 1.05em;
      margin-top: .45em;
      min-height: 45px;
      position: relative;
    }
    .active-filter {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--radius-sm);
      font-size: .93em;
      padding: .32em .85em;
      margin-right: 1.5px;
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      transition: background var(--transition);
      margin-bottom:.2em;
    }
    .active-filter .remove { margin-left: 4px; font-weight: bold; font-size: 1.125em; line-height:1; }
    .clear-all {
      border: none;
      background: rgba(0,0,0,.045);
      color: var(--accent);
      border-radius: var(--radius-sm);
      padding: .36em .99em;
      font-weight: 600;
      font-size: .98em;
      margin-left: 4px;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
    }
    .clear-all:focus,
    .clear-all:hover {
      background: var(--accent);
      color: #fff;
    }

    /* Sort / count bar */
    .products-toolbar {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      margin-bottom: .87em;
      gap: .5em 2vw;
      justify-content: space-between;
    }
    .product-count {
      color: #212121;
      font-size: 0.98em;
      font-weight: 500;
      margin-bottom: 2px;
    }
    .sort-dropdown {
      padding: 0.4em 1em;
      font-size: 0.98em;
      border: 1.2px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--bg);
      color: var(--fg);
      transition: border var(--transition);
      min-width: 80px;
    }
    .sort-dropdown:focus { border-color: var(--accent); outline: none; }

    /* Products grid */
    .products-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1em 1em;
      margin-bottom: 1.2em;
      width: 100%;
      min-height: 160px;
      animation: fadeInY .23s;
    }
    @media (min-width: 700px) {
      .products-grid { grid-template-columns: repeat(3,1fr); }
    }
    @media (min-width: 1120px) {
      .products-grid { grid-template-columns: repeat(4,1fr); }
    }

    .product-card {
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: box-shadow var(--transition), transform .13s;
      position: relative;
      min-width: 0;
      animation: fadeInY .2s;
      min-height: 250px;
    }
    .product-card:hover,
    .product-card:focus-within {
      box-shadow: 0 2px 14px 0 rgba(27,39,70,.12);
      transform: translateY(-2px) scale(1.012);
    }
    .product-img-box {
      background: #f3f4f6;
      width: 100%;
      min-height: var(--product-img-height);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-bottom: 1.3px solid var(--border);
      cursor: pointer;
    }
    .product-img-box img {
      width: 96%;
      height: var(--product-img-height);
      max-width: 200px;
      object-fit: cover;
      object-position: center;
      border-radius: .6em .6em 0 0;
      filter: brightness(1) saturate(1.1);
      background: #e7eaf3;
      transition: transform 0.23s cubic-bezier(.2,.6,.6,.9);
    }
    .product-card:hover .product-img-box img,
    .product-img-box:focus-visible img {
      transform: scale(1.043);
      filter: brightness(1.05) saturate(1.18) drop-shadow(0 1px 3px #aaa1);
    }
    .product-img-box [data-hover-img] {
      opacity: 0;
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      transition: opacity .18s;
    }
    .product-card:hover .product-img-box [data-hover-img],
    .product-img-box:focus-within [data-hover-img] {
      opacity: 1;
    }
    .product-badge {
      position: absolute; left: .8em; top: .75em;
      background: var(--danger);
      color: #fff;
      font-size: .89em;
      font-weight: 600;
      padding: .18em .64em;
      border-radius: .8em;
      z-index: 2;
      pointer-events: none;
      letter-spacing: .04em;
      opacity: .98;
    }
    .product-actions-row {
      display: flex;
      gap: .21em;
      position: absolute; right: .7em; top: .7em;
      z-index: 5;
    }
    .action-sml-btn {
      background: rgba(0,0,0,.18);
      color: #fff;
      border: none;
      font-size: 1.19em;
      border-radius: 50%;
      width: 2.1em; height: 2.1em;
      display: flex; align-items: center; justify-content: center;
      transition: background var(--transition);
      cursor: pointer;
      margin-left: 2px;
      backdrop-filter: blur(0.5px);
    }
    .action-sml-btn:focus { outline: 1.6px solid var(--accent);}
    .action-sml-btn:hover { background: var(--accent);}
    .wishlist-btn[aria-pressed="true"] .wishlist-icon  {
      color: var(--danger)!important;
      fill: var(--danger)!important;
      animation: pop .19s;
    }
    @keyframes pop { 80%{transform:scale(1.17);} 100%{transform:none;} }

    .product-info {
      padding: .64em .75em 1em .75em;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      flex: 1 1 auto;
      min-width: 0;
    }
    .product-cat,
    .product-title {
      display: -webkit-box;
      -webkit-line-clamp: 1;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      color: var(--accent);
      font-size: 0.94em;
      text-decoration: none;
      margin-bottom: .03em;
      font-weight: 500;
    }
    .product-title {
      color: var(--fg);
      font-weight: 600;
      font-size: 1em;
      margin: .15em 0 .09em 0;
    }
    .product-rating {
      margin-bottom:.14em;
      font-size: 1.08em;
      color: #aaa96c;
      letter-spacing: 0.05em;
    }
    .product-pricing {
      display: flex;
      align-items: flex-end;
      gap: .5em;
      font-size: 1em;
      margin-bottom: 0.41em;
      margin-top: .11em;
    }
    .product-pricing del {
      color: #a8aabc;
      font-size: .97em;
      margin-left: .3em;
      font-weight: 400;
    }
    .addtocart-btn {
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: var(--accent);
      color: #fff;
      font-size: .93em;
      border: none;
      border-radius: var(--radius-sm);
      padding: .54em 0.17em;
      margin-top: .43em;
      font-weight: 600;
      cursor: pointer;
      box-shadow: none;
      transition: background var(--transition), color var(--transition);
      gap: .35em;
      text-align:center;
      text-decoration: none;
    }
    .addtocart-btn:focus { outline: 1.7px solid var(--accent);}
    .addtocart-btn:active, .addtocart-btn:hover { background: var(--btn-hover);}
    /* Empty/error */
    .empty-box {
      min-height: 72px;
      color: #8f849b;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.11em;
      font-weight: 400;
      background: #f3f4f9;
      border-radius: var(--radius-sm);
      margin: .9em 0;
      padding: 1.1em 0.2em;
      letter-spacing: .02em;
      text-align:center;
      animation: fadeInY .21s;
    }
    /* Pagination */
    .pagination-row {
      display: flex;
      align-items: center;
      gap: .22em;
      justify-content: flex-end;
      margin-bottom: 1.3em;
      animation: fadeInY .16s;
    }
    .page-btn {
      border: 1.1px solid var(--border-dark);
      border-radius: 50%;
      width: 2.1em; height: 2.1em;
      background: #f4f6fb;
      color: var(--fg);
      font-weight: 600;
      font-size: .99em;
      margin: 0 1.5px;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      outline: none;
    }
    .page-btn.active, .page-btn:focus, .page-btn:hover {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }
    .page-btn[disabled] { background: #eee; color: #aaa; pointer-events: none; }
    .pagination-info { font-size: .93em; color: #83819b; margin-inline: 0.9em; }

    /* Deals of the Day */
    .deals-section {
      background: var(--deal-bg);
      border-radius: var(--border-radius);
      margin-top: 2em;
      padding: 1.5em .5em 1.4em .5em;
      box-shadow: 0 1px 7px 0 rgba(14,15,39,.09);
      animation: fadeInY .18s;
    }
    .deals-title {
      font-size: 1.1em;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: .8em;
      margin-left: 12px;
      letter-spacing: .01em;
    }
    .deals-scroll {
      overflow-x: auto;
      display: flex;
      flex-wrap: nowrap;
      gap: .9em;
      padding-bottom: 0.5em;
      scrollbar-width: thin;
    }
    .deals-product-card {
      min-width: 220px;
      max-width: 240px;
      background: #fff;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
      animation: fadeInY .18s;
      border: 1px solid var(--border);
      outline: none;
    }
    .deals-product-card .product-img-box {
      min-height: 120px;
      height: 120px;
    }
    .deals-product-info {
      padding: .63em .8em 1em .8em;
      display: flex; flex-direction: column; min-width: 0;
    }
    .deals-status-bar {
      height: .41em;
      width: 100%;
      background: linear-gradient(90deg,#fa5056 42%, #7d83ec 100%);
      border-radius: .7em;
      margin-bottom: .52em;
      margin-top:.31em;
      opacity: .8;
    }
    .countdown-box {
      font-size: 0.96em;
      color: var(--danger);
      font-weight: 600;
      background: #fcf2f2a2;
      border-radius: var(--radius-sm);
      padding: .23em .79em;
      margin: 0.32em 0 0;
      display: inline-block;
      letter-spacing: .01em;
      animation: fadeInY .25s;
    }

    /* Animation utility */
    @keyframes fadeInY {
      from { opacity: 0; transform: translateY(18px);}
      to { opacity: 1; transform: none;}
    }
    @keyframes slideFadeInX {
      from { opacity: 0; transform: translateX(-36px);}
      to { opacity: 1; transform: none;}
    }

    /* Utility / Accessibility */
    [tabindex] { outline: none;}
    .visually-hidden { 
      position: absolute; clip: rect(0 0 0 0);
      clip-path: inset(50%);
      width: 1px; height: 1px;
      overflow: hidden; white-space: nowrap;
    }

    /* Scrollbar minimal */
    ::-webkit-scrollbar { width: 5px; height: 6px; background: #eee;}
    ::-webkit-scrollbar-thumb { background: #bccce1; border-radius: 3px;}
    .products-grid::-webkit-scrollbar,
    .deals-scroll::-webkit-scrollbar {display:none;}

    /* Responsive tweaks */
    @media (max-width: 880px) {
      main { padding-top: .35em; }
      .main-row { padding-inline: 1.5vw;}
      .products-toolbar,.filters-bar { padding-inline: .21em; }
      .filters-bar { min-height:38px; }
      .product-card { font-size: .9682em;}
    }
    @media (max-width: 576px) {
      main { padding-bottom: 0.7em;}
      .product-card, .deals-product-card { font-size: .89em; }
    }
    @media (max-width: 410px) {
      .product-title { font-size: .9em;}
      .addtocart-btn, .clear-all, .sidebar-search button { font-size: .91em;}
      .sidebar-search input { font-size: .92em;}
    }
  </style>
</head>
<body>
  <!-- Sticky Header -->
  <header>
    <button class="header-btn" id="openSidebarBtn" aria-label="Open filter sidebar" tabindex="0">
      <svg width="1.4em" height="1.4em" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="2" rx="1" fill="currentColor"/><rect x="6" y="11" width="12" height="2" rx="1" fill="currentColor"/><rect x="10" y="17" width="4" height="2" rx="1" fill="currentColor"/></svg>
    </button>
    <h1 class="header-title" aria-label="Shop Home">Shop</h1>
    <span class="badge" id="cartBadge" aria-label="Items in Cart" tabindex="0" style="display:none;">0</span>
  </header>

  <!-- Sidebar backdrop (mobile) -->
  <div class="sidebar-backdrop" id="sidebarBackdrop" hidden></div>

  <!-- Filters Sidebar -->
  <aside class="shop-sidebar" id="sidebar" aria-label="Product filters" tabindex="0" aria-modal="true">
    <button class="sidebar-close-btn" id="closeSidebarBtn" aria-label="Close Filters">&times;</button>
    <form id="sidebarSearchForm" class="sidebar-search" autocomplete="off" onsubmit="return false">
      <label for="sidebarSearchInput" class="visually-hidden">Search products:</label>
      <input type="text" placeholder="Search products..." id="sidebarSearchInput" aria-label="Search products" autocomplete="off">
      <button type="submit" aria-label="Search"><svg width="1.13em" height="1.13em" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke-width="2"/><path d="M21 21l-3.8-3.8" stroke-width="2" stroke-linecap="round"></path></svg></button>
    </form>
    <div id="sidebarSections"></div>
  </aside>

  <main>
    <div class="main-row">
      <!-- Sidebar gap for desktop -->
      <aside style="display:none;"></aside>
      <!-- Main central area -->
      <section class="shop-main" id="shopMain">
        <!-- Active Filters Bar -->
        <nav class="filters-bar" id="activeFilters" aria-label="Active filters"></nav>

        <!-- Products toolbar -->
        <div class="products-toolbar">
          <span class="product-count" id="productCount"></span>
          <div>
            <label for="sortDropdown" class="visually-hidden">Sort by</label>
            <select id="sortDropdown" class="sort-dropdown" aria-label="Sort products">
              <option value="newest">Newest</option>
              <option value="price-low">Price: Low&nbsp;-&nbsp;High</option>
              <option value="price-high">Price: High&nbsp;-&nbsp;Low</option>
              <option value="name-asc">Name: A-Z</option>
              <option value="name-desc">Name: Z-A</option>
              <option value="rating-high">Top Rated</option>
              <option value="popular">Popular</option>
            </select>
          </div>
        </div>

        <!-- Products grid -->
        <section class="products-grid" id="productsGrid"></section>
        <nav class="pagination-row" id="paginationRow" aria-label="Pagination"></nav>

        <!-- Deals of the Day -->
        <section class="deals-section">
          <header class="deals-title">Deal of the Day</header>
          <div class="deals-scroll" id="dealsScroll" tabindex="0" role="region" aria-label="Deals of the Day"></div>
        </section>
      </section>
    </div>
  </main>
  <!-- Icons for JS-generated (wishlist/star) -->
  <svg height="0" width="0">
    <symbol id="heart-outline" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M11.82 4.77L12 4.95l.18-.18c2.25-2.25 5.89-2.25 8.13 0 2.25 2.25 
      2.25 5.89 0 8.13l-6.72 6.72c-.88.88-2.31.88-3.19 0l-6.72-6.72c-2.25-2.25-2.25-5.89 0-8.13 2.25-2.25 5.89-2.25 8.13 0z" stroke-width="1.7"/>
    </symbol>
    <symbol id="heart-solid" viewBox="0 0 24 24" fill="#e63946">
      <path d="M11.82 4.77L12 4.95l.18-.18c2.25-2.25 5.89-2.25 8.13 0 2.25 2.25 
      2.25 5.89 0 8.13l-6.72 6.72c-.88.88-2.31.88-3.19 0l-6.72-6.72c-2.25-2.25-2.25-5.89 0-8.13 2.25-2.25 5.89-2.25 8.13 0z"/>
    </symbol>
    <symbol id="star" viewBox="0 0 20 20"><polygon points="10,2.8 12.36,7.24 17.32,7.92 13.62,11.3 14.47,16.16 10,13.78 5.53,16.16 6.38,11.3 2.68,7.92 7.64,7.24 "/></symbol>
    <symbol id="star-o" viewBox="0 0 20 20"><polygon fill="none" stroke="currentColor" stroke-width="1.24" points="10,2.8 12.36,7.24 17.32,7.92 13.62,11.3 14.47,16.16 10,13.78 5.53,16.16 6.38,11.3 2.68,7.92 7.64,7.24 "/></symbol>
  </svg>
  <script>
    // --- Utility ---
    const params = new URLSearchParams(window.location.search);
    const sidebar = document.getElementById('sidebar');
    const sidebarBackdrop = document.getElementById('sidebarBackdrop');
    const openSidebarBtn = document.getElementById('openSidebarBtn');
    const closeSidebarBtn = document.getElementById('closeSidebarBtn');
    const sidebarSections = document.getElementById('sidebarSections');
    const mainRow = document.querySelector('.main-row');
    const shopMain = document.getElementById('shopMain');
    const productsGrid = document.getElementById('productsGrid');
    const dealsScroll = document.getElementById('dealsScroll');
    const productCount = document.getElementById('productCount');
    const paginationRow = document.getElementById('paginationRow');
    const activeFilters = document.getElementById('activeFilters');
    const sortDropdown = document.getElementById('sortDropdown');
    const sidebarSearchForm = document.getElementById('sidebarSearchForm');
    const sidebarSearchInput = document.getElementById('sidebarSearchInput');
    // --- State ---
    let state = {
      categories: [], brands: [], sizes: [], tags: [], deals: [],
      products: [], total: 0, page: 1, totalPages: 1,
      filters: {}, wishlist: [],
      loading: false
    };
    const FILTER_LABEL_MAP = {
      search: "Search",
      mainCat: "Category",
      brand: "Brand",
      priceRange: "Price",
      size: "Size",
      tag: "Tag"
    };
    // --- Sidebar Toggle (Mobile) ---
    function setSidebar(open) {
      if(open) {
        sidebar.classList.add('sidebar-open');
        sidebarBackdrop.hidden = false;
        document.body.style.overflow = "hidden";
        sidebar.focus();
      } else {
        sidebar.classList.remove('sidebar-open');
        sidebarBackdrop.hidden = true;
        document.body.style.overflow = "";
        openSidebarBtn.focus();
      }
    }
    openSidebarBtn.addEventListener('click',()=>setSidebar(true));
    closeSidebarBtn.addEventListener('click',()=>setSidebar(false));
    sidebarBackdrop.addEventListener('click',()=>setSidebar(false));
    // Close sidebar on wide screens
    window.addEventListener('resize',()=>{
      if(window.innerWidth >= 992){ setSidebar(false);}
    });
    sidebar.addEventListener('keydown', e=>{
      if(e.key=="Escape") setSidebar(false);
    });

    // --- Fetch Data and Render ---
    async function fetchData() {
      state.loading = true;
      const url = "/user/products/shop/api/filtered/all?" + params.toString();
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Fetch error");
        const data = await response.json();
        state.categories = data.mainCategories || [];
        state.brands = data.brands || [];
        state.sizes = data.variantSizes || [];
        state.tags = data.tags || [];
        state.deals = data.dealsOfTheDayProducts || [];
        state.products = data.products || [];
        state.total = data.totalProducts || 0;
        state.totalPages = +data.totalPages || 1;
        state.page = +data.currentPage || 1;
        state.filters = data.queryOptions || {};
        state.wishlist = data.wishlistItemIds || [];
      } catch(e) {
        state = {...state, products:[], total:0, totalPages:1, page:1};
      }
      renderSidebar();
      renderActiveFilters();
      renderToolbar();
      renderProducts();
      renderPagination();
      renderDeals();
      state.loading = false;
    }

    // --- SIDEBAR: filters ---
    function collapseToggle(evt){
      const section = evt.target.closest('.sidebar-title');
      const panel = section && section.nextElementSibling;
      if(!section || !panel) return;
      panel.hidden = !panel.hidden;
      section.classList.toggle('collapsed', panel.hidden);
    }
    function renderSidebar() {
      let res="";
      // helper to mark filter as active
      const q = state.filters;
      // 1. Category
      res += `
      <nav class="sidebar-section" aria-label="Category">
        <div class="sidebar-title" tabindex="0" onclick="event.stopPropagation();collapseToggle(event)" aria-expanded="true">
          <span class="collapse-icon">&#9654;</span> Category
        </div>
        <ul class="sidebar-list" aria-label="Categories" >
          ${state.categories.map(cat =>
            `<li>
              <a href="javascript:void(0);" aria-pressed="${q.mainCat===cat._id}" class="${q.mainCat===cat._id?'active':''}" 
                onclick="updateFilter('mainCat','${cat._id}')">${cat.name}</a>
            </li>`).join('')}
        </ul>
      </nav>
      `;
      // 2. Brand
      res += `
      <nav class="sidebar-section" aria-label="Brand">
        <div class="sidebar-title" tabindex="0" onclick="event.stopPropagation();collapseToggle(event)" aria-expanded="true">
          <span class="collapse-icon">&#9654;</span> Brand
        </div>
        <ul class="sidebar-list" aria-label="Brands">
          ${state.brands.map(b=>
            `<li>
              <a href="javascript:void(0);" aria-pressed="${q.brand===b._id}" class="${q.brand===b._id?'active':''}"
                onclick="updateFilter('brand','${b._id}')">${b.name}</a>
            </li>`).join('')}
        </ul>
      </nav>
      `;
      // 3. Price
      const priceRanges = [
        {label:"All", range:""},
        {label:"₹0&nbsp;-&nbsp;₹50", range:"0-50"},
        {label:"₹50&nbsp;-&nbsp;₹100", range:"50-100"},
        {label:"₹100&nbsp;-&nbsp;₹150", range:"100-150"},
        {label:"₹150&nbsp;-&nbsp;₹200", range:"150-200"},
        {label:"₹200+", range:"200+"}
      ];
      res += `
      <nav class="sidebar-section" aria-label="Price">
        <div class="sidebar-title" tabindex="0" onclick="event.stopPropagation();collapseToggle(event)" aria-expanded="true">
          <span class="collapse-icon">&#9654;</span> Price
        </div>
        <ul class="sidebar-list" aria-label="Price Range">
          ${priceRanges.map(item => 
             `<li>
                <a href="javascript:void(0);" class="${q.priceRange===item.range?'active':''}" aria-pressed="${q.priceRange===item.range}"
                onclick="updateFilter('priceRange','${item.range}')">${item.label}</a>
              </li>`
            ).join('')}
        </ul>
      </nav>
      `;
      // 4. Size (if any)
      if(state.sizes && state.sizes.length){
        res+=`
        <nav class="sidebar-section" aria-label="Size">
          <div class="sidebar-title" tabindex="0" onclick="event.stopPropagation();collapseToggle(event)" aria-expanded="true">
            <span class="collapse-icon">&#9654;</span> Size
          </div>
          <div class="sidebar-value-list" aria-label="Sizes">
            ${state.sizes.map(s=>
              `<label class="${q.size===s?'active':''}" tabindex="0">
                <input type="radio" name="size" value="${s}" 
                  onchange="updateFilter('size','${s}')" ${q.size===s?'checked':''}>
                ${s}
              </label>`).join('')}
          </div>
        </nav>
        `;
      }
      // 5. Tags (if any)
      if(state.tags && state.tags.length){
        res+=`
        <nav class="sidebar-section" aria-label="Tags">
          <div class="sidebar-title" tabindex="0" onclick="event.stopPropagation();collapseToggle(event)" aria-expanded="true">
            <span class="collapse-icon">&#9654;</span> Tags
          </div>
          <div class="sidebar-tags" aria-label="Tags">
            ${state.tags.map(tag=>
              `<a href="javascript:void(0);" class="${q.tag===tag?'active':''}" aria-pressed="${q.tag===tag}" 
                onclick="updateFilter('tag','${tag}')">${tag}</a>`
            ).join('')}
          </div>
        </nav>
        `;
      }
      sidebarSections.innerHTML = res;
    }

    // --- FILTERS: active bar
    function renderActiveFilters() {
      let active = Object.entries(state.filters||{})
        .filter(([k,v])=>v)
        .map(([k,v])=>{
          let display = "";
          if (k==="mainCat"){
            let c = state.categories.find(c=>c._id===v);
            display = c?c.name:v;
          } else if(k==="brand"){
            let b = state.brands.find(b=>b._id===v);
            display = b?b.name:v;
          } else if(k==="priceRange") {
            display = v.replace(/\+$/,"+").replace("-"," – ₹");
            if(v==="") display = "All";
          } else {
            display = v;
          }
          return `<button class="active-filter" aria-label="Remove filter ${FILTER_LABEL_MAP[k]||k}" 
            onclick="removeFilter('${k}')">${FILTER_LABEL_MAP[k]||k}: ${display}
            <span class="remove" aria-hidden="true">&times;</span></button>`;
        }).join('');
      if(active){
        active += `<button class="clear-all" onclick="clearAllFilters()" aria-label="Clear all filters">Clear All</button>`;
      }
      activeFilters.innerHTML = active || "";
    }

    // --- Toolbar (sort/count)
    function renderToolbar() {
      productCount.textContent = `Showing ${state.products.length} of ${state.total} products`;
      sortDropdown.value = state.filters.sortBy || "newest";
    }
    sortDropdown.onchange = () => updateFilter('sortBy', sortDropdown.value);

    // --- Product grid
    function productCardHTML(prod) {
      let [img1,img2] = prod.images.slice(0,2);
      img2 = img2 || img1;
      let loved = !!state.wishlist.includes(prod._id);
      let sale = (prod.salePrice && prod.regularPrice && prod.salePrice<prod.regularPrice) ? Math.round((1-prod.salePrice/prod.regularPrice)*100) : 0;
      let cat = prod.category?.name||"";
      let url = `/user/products/${prod._id}`;
      // Rating
      function drawStars(val=0) {
        let arr = [1,2,3,4,5].map(i=>
          `<svg width="1em" height="1em" viewBox="0 0 20 20" fill="none"><use href="#${i<=val?"star":"star-o"}"></use></svg>`
        );
        return arr.join('');
      }
      return `
      <div class="product-card" tabindex="0" aria-label="View ${prod.name}">
        <a class="product-img-box" href="${url}" tabindex="-1">
          <img src="${img1}" alt="${prod.name}" loading="lazy">
          ${img2?`<img src="${img2}" alt="" data-hover-img loading="lazy">`:''}
          ${sale>1?`<span class="product-badge">${sale}% OFF</span>`:""}
        </a>
        <div class="product-actions-row">
          <button class="action-sml-btn wishlist-btn" aria-pressed="${loved}"
            aria-label="${loved?'Remove':'Add'} from wishlist" data-id="${prod._id}" tabindex="0">
            <svg class="wishlist-icon" width="1.1em" height="1.1em" viewBox="0 0 24 24">
              <use href="#${loved?'heart-solid':'heart-outline'}"></use>
            </svg>
          </button>
        </div>
        <div class="product-info">
          <a class="product-cat" href="${url}" tabindex="-1">${cat}</a>
          <a class="product-title" href="${url}" tabindex="-1">${prod.name}</a>
          <div class="product-rating" title="Product rating">
            ${drawStars(prod.avgRating?Math.round(prod.avgRating):3)}
          </div>
          <div class="product-pricing">
            <span aria-label="Price">₹${prod.salePrice || prod.regularPrice}</span>
            ${sale>1?`<del>₹${prod.regularPrice}</del>`:""}
          </div>
          <button class="addtocart-btn" tabindex="0" onclick="addToCart('${prod._id}')"
           aria-label="Add to cart for ${prod.name}" >
            Add&nbsp;to&nbsp;cart
            <svg width="1.2em" height="1.2em" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.3 3.25a.75.75 0 0 0 0 1.5h1.18a1.25 1.25 0 0 1 1.07.65l1.25 8.92c.16 1.11 1.11 2 2.23 2h10.34a.75.75 0 0 0 0-1.5H5.96a.75.75 0 0 1-.68-.73L5.1 5.01A1.25 1.25 0 0 0 3.49 3.25H2.3zm3.52 2.76l.81 5.75h10.07l1.62-4.87-12.5-.88zm1.56 11.49c-.97 0-1.76.79-1.76 1.76s.79 1.76 1.76 1.76 1.76-.79 1.76-1.76-.79-1.76-1.76-1.76zm6.21 1.76c0-.97.79-1.76 1.76-1.76s1.76.79 1.76 1.76-.79 1.76-1.76 1.76-1.76-.79-1.76-1.76z" fill="currentColor"/></svg>
          </button>
        </div>
      </div>
      `;
    }
    function renderProducts() {
      if (state.products && state.products.length) {
        productsGrid.innerHTML = state.products.map(productCardHTML).join('');
      } else if(!state.loading) {
        productsGrid.innerHTML = `<div class="empty-box">No products found for selected filters.</div>`;
      }
    }

    // --- Pagination
    function renderPagination() {
      let totalPages = Math.max(1, state.totalPages);
      let cur = state.page;
      let s = '';
      if (totalPages > 1) {
        let first = Math.max(1, cur-1), last = Math.min(totalPages, cur+1);
        if(cur>2) first=cur-1;
        if(cur<totalPages-1) last=cur+1;
        // prev
        s += `<button class="page-btn" ${cur===1?'disabled':''} onclick="updateFilter('page',${cur-1})" aria-label="Previous page">&lt;</button>`;
        // page nums (only 3)
        for(let p=first;p<=last;p++){
          s += `<button class="page-btn${p===cur?' active':''}" ${p===cur?'aria-current="page"':''} onclick="updateFilter('page',${p})">${p}</button>`;
        }
        // next
        s += `<button class="page-btn" ${cur===totalPages?'disabled':''} onclick="updateFilter('page',${cur+1})" aria-label="Next page">&gt;</button>`;
        s += `<span class="pagination-info">Page ${cur} of ${totalPages}</span>`;
      }
      paginationRow.innerHTML = s;
    }

    // --- Deals of the Day
    function dealsProductCardHTML(prod){
      let [img1,img2]=prod.images.slice(0,2);
      img2=img2||img1;
      let loved=!!state.wishlist.includes(prod._id);
      let cat=prod.category?.name||"";
      let sale=(prod.salePrice && prod.regularPrice && prod.salePrice<prod.regularPrice)?Math.round((1-prod.salePrice/prod.regularPrice)*100):0;
      let url=`/user/products/${prod._id}`;
      function drawStars(val=0){
        let arr=[1,2,3,4,5].map(i=>
          `<svg width="1em" height="1em" viewBox="0 0 20 20" fill="none"><use href="#${i<=val?"star":"star-o"}"></use></svg>`); return arr.join('');
      }
      // fake countdown (just ends in 1 day 9h 0m 0s)
      let countdown = `<span class="countdown-box">Ends in: 1d 9h 0m</span>`;
      return `
        <div class="deals-product-card" tabindex="0" aria-label="Deal: ${prod.name}">
          <a class="product-img-box" href="${url}" tabindex="-1">
            <img src="${img1}" alt="${prod.name}" loading="lazy">
            ${img2?`<img src="${img2}" alt="" data-hover-img loading="lazy">`:''}
            ${sale>1?`<span class="product-badge">${sale}% OFF</span>`:""}
          </a>
          <div class="product-actions-row" style="top:.6em;">
            <button class="action-sml-btn wishlist-btn" aria-pressed="${loved}"
              aria-label="${loved?'Remove':'Add'} from wishlist" data-id="${prod._id}" tabindex="0">
              <svg class="wishlist-icon" width="1.1em" height="1.1em"><use href="#${loved?'heart-solid':'heart-outline'}"></use></svg>
            </button>
          </div>
          <div class="deals-product-info">
            <a class="product-cat" href="${url}" tabindex="-1">${cat}</a>
            <a class="product-title" href="${url}" tabindex="-1">${prod.name}</a>
            <div class="product-rating">${drawStars(prod.avgRating?Math.round(prod.avgRating):3)}</div>
            <div class="product-pricing">
              <span>₹${prod.salePrice || prod.regularPrice}</span>
              ${sale>1?`<del>₹${prod.regularPrice}</del>`:""}
            </div>
            <div class="deals-status-bar"></div>
            ${countdown}
            <button class="addtocart-btn" tabindex="0"
                onclick="addToCart('${prod._id}')"
                aria-label="Add to cart for ${prod.name}">
                Add&nbsp;to&nbsp;cart
            </button>
          </div>
        </div>`;
    }
    function renderDeals() {
      if(state.deals && state.deals.length){
        dealsScroll.innerHTML = state.deals.map(dealsProductCardHTML).join('');
      }
      else {
        dealsScroll.innerHTML = `<div class="empty-box">No deals available.</div>`;
      }
    }

    // --- Filter Events ---
    // On search
    sidebarSearchForm.onsubmit = ()=>{
      let v = sidebarSearchInput.value.trim();
      updateFilter('search', v);
      setSidebar(false);
      return false;
    }
    sidebarSearchInput.value = params.get('search') || '';

    // update filter (set or remove value)
    window.updateFilter = function(key, value){
      if(key==="page") params.set('page', value);
      else {
        if(!value && value!=="0") params.delete(key);
        else params.set(key,value);
        params.set('page',1);
      }
      fetchData();
      //window.history.replaceState({},'',`${location.pathname}?${params.toString()}`);
      if(window.innerWidth<992) setSidebar(false); // close on mobile
    };
    window.removeFilter = function(key){
      params.delete(key); fetchData();
    };
    window.clearAllFilters = function(){
      params.forEach((v,k)=>params.delete(k));
      sidebarSearchInput.value = "";
      fetchData();
    }

    // --- Add To Cart / Wishlist ---
    window.addToCart = async function(productId){
      try {
        const res = await fetch('/cart/add', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ productId, qty: 1 })
        });
        if(res.ok) alert('Added to cart!'); // You may wish to show a toast
      } catch(e){}
    };

    // Wishlist event handled global via delegation
    document.addEventListener('click', function(evt){
      const btn = evt.target.closest('.wishlist-btn');
      if(btn){
        evt.stopPropagation(); evt.preventDefault();
        const productId = btn.getAttribute('data-id');
        toggleWishlist(productId);
      }
    });
    // (Assume toggleWishlist API exists, else stub)
    window.toggleWishlist = async function(productId){
      try{
        await fetch("/wishlist/toggle",{
          method:"POST",headers:{'Content-Type': 'application/json'},
          body: JSON.stringify({productId})});
      }catch(e){}
      // Always re-fetch to reflect correct state
      fetchData();
    };

    // --- Accessibility for collapsible sidebar sections ---
    // (handled via click on .sidebar-title, see above)
    window.collapseToggle = collapseToggle;

    // --- Initial load
    fetchData();

    // --- Utility: Keyboard nav for sidebar open
    openSidebarBtn.addEventListener('keydown',e=>{if(e.key===" "||e.key==="Enter"){e.preventDefault();setSidebar(true);}});
  </script>
</body>
</html>
