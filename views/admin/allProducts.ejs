<section class="products-management">
  <div class="container-fluid">
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading...</p>
      </div>
    </div>

    <div class="content-wrapper">
      <div class="page-card">
        <div class="page-header">
          <div class="header-content">
            <h1 class="page-title">Products </h1>
            <div class="stats-row">
              <span class="stat-badge">
                <span class="stat-number"><%= products.length %></span>
                <span class="stat-label">Showing</span>
              </span>
              <span class="stat-divider">/</span>
              <span class="stat-badge">
                <span class="stat-number"><%= totalProducts %></span>
                <span class="stat-label">Total</span>
              </span>
            </div>
          </div>
          <a href="/admin/products/create" class="btn btn-primary btn-add">
            <i class="icon-plus"></i>
            <span>Add Product</span>
          </a>
        </div>


        <div class="controls-panel">
          <div class="filters-grid">
            <div class="filter-item search-filter">
              <form class="search-form" id="search-form">
                <div class="search-wrapper">
                  <input type="text" 
                         id="search-input" 
                         name="search" 
                         class="search-input" 
                         placeholder="Search products..."
                         value="<%= search || '' %>">
                  <button type="submit" class="search-btn">
                 <svg width="20" height="20" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.2498 5.75037C10.8356 5.75037 10.4998 6.08615 10.4998 6.50037C10.4998 6.91458 10.8356 7.25037 11.2498 7.25037C13.874 7.25037 16.0011 9.37718 16.0011 12.0004C16.0011 12.4146 16.3369 12.7504 16.7511 12.7504C17.1653 12.7504 17.5011 12.4146 17.5011 12.0004C17.5011 8.54842 14.7021 5.75037 11.2498 5.75037Z" fill="#fff"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M2 11.9989C2 6.89126 6.14154 2.75098 11.25 2.75098C16.3585 2.75098 20.5 6.89126 20.5 11.9989C20.5 14.2836 19.6714 16.3747 18.2983 17.9883L21.7791 21.4695C22.072 21.7624 22.072 22.2372 21.7791 22.5301C21.4862 22.823 21.0113 22.823 20.7184 22.5301L17.2372 19.0486C15.6237 20.4197 13.5334 21.2469 11.25 21.2469C6.14154 21.2469 2 17.1066 2 11.9989ZM11.25 4.25098C6.96962 4.25098 3.5 7.72003 3.5 11.9989C3.5 16.2779 6.96962 19.7469 11.25 19.7469C15.5304 19.7469 19 16.2779 19 11.9989C19 7.72003 15.5304 4.25098 11.25 4.25098Z" fill="#fff"/>
</svg>

                  </button>
                </div>
              </form>
            </div>

            <div class="filter-item">
              <label class="filter-label">Status</label>
              <select class="filter-select" id="status-filter">
                <option value="all" <%= status==='all' ? 'selected' : '' %>>All</option>
                <option value="active" <%= status==='active' ? 'selected' : '' %>>Active</option>
                <option value="inactive" <%= status==='inactive' ? 'selected' : '' %>>Inactive</option>
              </select>
            </div>

            <div class="filter-item">
              <label class="filter-label">Category</label>
              <select class="filter-select" id="category-filter">
                <option value="all" <%= categoryFilter === 'all' ? 'selected' : '' %>>All Categories</option>
                <% if (categories && categories.length > 0) { %>
                  <% categories.forEach(category => { %>
                    <option value="<%= category._id %>" <%= categoryFilter == category._id ? 'selected' : '' %>><%= category.name %></option>
                  <% }) %>
                <% } %>
              </select>
            </div>

            <div class="filter-item">
              <label class="filter-label">Brand </label>
              <select class="filter-select" id="brand-filter">
                <option value="all" <%= brandFilter==='all' ? 'selected' : '' %>>All Brands</option>
                <% if (brands && brands.length > 0) { %>
                  <% brands.forEach(brand => { %>
                    <option value="<%= brand._id %>" <%= brandFilter===brand._id.toString() ? 'selected' : '' %>><%= brand.name %></option>
                  <% }) %>
                <% } %>
              </select>
            </div>

            <div class="filter-item">
              <label class="filter-label">Sort</label>
              <div class="sort-controls">
                <select class="filter-select" id="sort-field">
                  <option value="name" <%= sortField==='name' ? 'selected' : '' %>>Name</option>
                  <option value="regularPrice" <%= sortField==='regularPrice' ? 'selected' : '' %>>Price</option>
                  <option value="stock" <%= sortField==='stock' ? 'selected' : '' %>>Stock</option>
                  <option value="createdAt" <%= sortField==='createdAt' ? 'selected' : '' %>>Date</option>
                </select>
                <button class="sort-toggle" id="sort-order" type="button">
                  <i class="icon-<%= sortOrder==='asc' ? 'arrow-up' : 'arrow-down' %>"></i>
                </button>
              </div>
            </div>

            <div class="filter-item">
              <button class="btn btn-ghost btn-reset" id="reset-filters">
                <i class="icon-refresh"></i>
                <span>Reset</span>
              </button>
            </div>
          </div>
        </div>

        <div class="pagination-wrapper">
          <div class="pagination-info">
            <span class="page-text">Page</span>
            <input type="number" 
                   min="1" 
                   max="<%= totalPages %>"
                   id="page-input"
                   class="page-input" 
                   value="<%= currentPage %>">
            <span class="page-text">of <%= totalPages %></span>
          </div>
          <div class="pagination-controls">
            <button class="btn btn-ghost btn-sm" 
                    id="prev-btn"
                    <%= currentPage<=1 ? 'disabled' : '' %>
                    onclick="goToPage(<%= currentPage-1 %>)">
              <i class="icon-chevron-left"></i>
            </button>
            <button class="btn btn-ghost btn-sm" 
                    id="next-btn"
                    <%= currentPage>=totalPages ? 'disabled' : '' %>
                    onclick="goToPage(<%= currentPage+1 %>)">
              <i class="icon-chevron-right"></i>
            </button>
          </div>
        </div>


        <div class="products-container">
          <% if (products && products.length > 0) { %>
            <div class="table-view">
              <table class="products-table">
                <thead>
                  <tr>
                    <th class="sortable" onclick="setSortField('name')">
                      <span>Product</span>
                      <% if (sortField === 'name') { %>
                        <i class="sort-icon icon-<%= sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' %>"></i>
                      <% } %>
                    </th>
                    <th class="sortable" onclick="setSortField('regularPrice')">
                      <span>Price</span>
                      <% if (sortField === 'regularPrice') { %>
                        <i class="sort-icon icon-<%= sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' %>"></i>
                      <% } %>
                    </th>
                    <th class="sortable" onclick="setSortField('stock')">
                      <span>Stock</span>
                      <% if (sortField === 'stock') { %>
                        <i class="sort-icon icon-<%= sortOrder === 'asc' ? 'arrow-up' : 'arrow-down' %>"></i>
                      <% } %>
                    </th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% products.forEach((product) => { %>
                  <tr class="product-row">
                    <td class="product-cell">
                      <div class="product-info">
                        <div class="product-image">
                          <% if (product.images && product.images.length > 0) { %>
                            <img src="<%= product.images[0] %>" alt="<%= product.name %>" loading="lazy">
                          <% } else { %>
                            <div class="image-placeholder">
                              <i class="icon-image"></i>
                            </div>
                          <% } %>
                          <% if (product.isFeatured) { %>
                            <span class="featured-badge">
                              <i class="icon-star"></i>
                            </span>
                          <% } %>
                        </div>
                        <div class="product-details">
                          <h3 class="product-name"><%= product.name %></h3>
                          <% if (product.brand) { %>
                            <span class="product-brand"><%= product.brand.name %></span>
                          <% } %>
                        </div>
                      </div>
                    </td>
                    <td class="price-cell">
                      <div class="price-info">
                        <span class="regular-price">$<%= product.salePrice.toFixed(2) %></span>
                        <% if (product.salePrice > 0 && product.salePrice < product.regularPrice) { %>
                          <span class="sale-price">$<%= product.regularPrice.toFixed(2) %></span>
                          <span class="discount-badge">
                            <%= Math.round(((product.regularPrice - product.salePrice) / product.regularPrice) * 100) %>% OFF
                          </span>
                        <% } %>
                      </div>
                    </td>
                    <td class="stock-cell">
                      <span class="stock-badge <%= product.stock <= 10 ? 'low-stock' : product.stock <= 0 ? 'out-of-stock' : 'in-stock' %>">
                        <%= product.stock %>
                      </span>
                    </td>
                    <td class="category-cell">
                      <% if (product.category) { %>
                        <span class="category-tag"><%= product.category.name %></span>
                      <% } %>
                    </td>
                    <td class="status-cell">
                      <span class="status-badge <%= product.isActive ? 'active' : 'blocked' %>">
                        <%= product.isActive ? 'Active' : 'Inactive' %>
                      </span>
                    </td>
                    <td class="actions-cell">
                      <div class="action-buttons">
                        <a href="/admin/products/edit/<%= product._id %>" class="btn btn-ghost btn-sm" title="Edit">
                   <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M19.3028 3.7801C18.4241 2.90142 16.9995 2.90142 16.1208 3.7801L14.3498 5.5511C14.3442 5.55633 14.3387 5.56166 14.3333 5.5671C14.3279 5.57253 14.3225 5.57803 14.3173 5.58359L5.83373 14.0672C5.57259 14.3283 5.37974 14.6497 5.27221 15.003L4.05205 19.0121C3.9714 19.2771 4.04336 19.565 4.23922 19.7608C4.43508 19.9567 4.72294 20.0287 4.98792 19.948L8.99703 18.7279C9.35035 18.6203 9.67176 18.4275 9.93291 18.1663L20.22 7.87928C21.0986 7.0006 21.0986 5.57598 20.22 4.6973L19.3028 3.7801ZM14.8639 7.15833L6.89439 15.1278C6.80735 15.2149 6.74306 15.322 6.70722 15.4398L5.8965 18.1036L8.56029 17.2928C8.67806 17.257 8.7852 17.1927 8.87225 17.1057L16.8417 9.13619L14.8639 7.15833ZM17.9024 8.07553L19.1593 6.81862C19.4522 6.52572 19.4522 6.05085 19.1593 5.75796L18.2421 4.84076C17.9492 4.54787 17.4743 4.54787 17.1814 4.84076L15.9245 6.09767L17.9024 8.07553Z" fill="#323544"/>
</svg>

                        </a>
                        <button class="btn btn-ghost btn-sm" 
                                onclick="toggleFeatured('<%= product._id %>', '<%= product.name %>', `<%= product.isFeatured %>`)"
                                title="<%= product.isFeatured ? 'Remove from Featured' : 'Mark as Featured' %>">
                          <% if(product.isFeatured) { %>  

                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M7.21481 8.27571L2.21967 3.28057C1.92678 2.98768 1.92678 2.51281 2.21967 2.21991C2.51256 1.92702 2.98744 1.92702 3.28033 2.21991L21.7794 20.7189C22.0722 21.0118 22.0722 21.4867 21.7794 21.7796C21.4865 22.0725 21.0116 22.0725 20.7187 21.7796L18.3107 19.3716L18.3703 19.555C18.4707 19.864 18.3607 20.2026 18.0978 20.3936C17.835 20.5845 17.479 20.5845 17.2161 20.3936L11.9996 16.6035L6.78296 20.3936C6.52009 20.5845 6.16415 20.5845 5.90128 20.3936C5.63841 20.2026 5.52842 19.864 5.62883 19.555L7.62139 13.4226L2.40479 9.63247C2.14193 9.44149 2.03193 9.10297 2.13234 8.79395C2.23275 8.48493 2.52071 8.27571 2.84563 8.27571L7.21481 8.27571ZM15.9744 17.0353L16.2304 17.8233L12.4404 15.0697C12.1775 14.8787 11.8216 14.8787 11.5587 15.0697L7.7687 17.8233L9.21636 13.3678C9.31676 13.0588 9.20677 12.7203 8.9439 12.5293L5.1539 9.77571H8.71481L15.9744 17.0353Z" fill="#323544"/>
<path d="M18.8452 9.77571L15.3808 12.2927L16.4547 13.3666L21.5943 9.63247C21.8572 9.44149 21.9672 9.10297 21.8668 8.79395C21.7664 8.48493 21.4784 8.27571 21.1535 8.27571L14.7054 8.27571L12.7128 2.14324C12.6124 1.83422 12.3245 1.625 11.9996 1.625C11.6746 1.625 11.3867 1.83422 11.2863 2.14324L9.80136 6.71327L10.9918 7.90368L11.9996 4.80205L13.4472 9.25747C13.5476 9.56649 13.8356 9.77571 14.1605 9.77571H18.8452Z" fill="#323544"/>
</svg> 

<%}else{%>


                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" transform="rotate(0 0 0)">
<path d="M12.6722 2.04308C12.5459 1.78707 12.2851 1.625 11.9996 1.625C11.7142 1.625 11.4534 1.78707 11.3271 2.04308L8.67288 7.4211L2.73788 8.28351C2.45536 8.32456 2.22065 8.52244 2.13243 8.79395C2.04421 9.06546 2.11779 9.36351 2.32222 9.56278L6.61682 13.749L5.603 19.66C5.55475 19.9414 5.67041 20.2257 5.90137 20.3936C6.13233 20.5614 6.43853 20.5835 6.69122 20.4506L11.9996 17.6598L17.3081 20.4506C17.5608 20.5835 17.867 20.5614 18.0979 20.3936C18.3289 20.2257 18.4445 19.9414 18.3963 19.66L17.3825 13.749L21.6771 9.56278C21.8815 9.36351 21.9551 9.06546 21.8669 8.79395C21.7786 8.52244 21.5439 8.32456 21.2614 8.28351L15.3264 7.4211L12.6722 2.04308Z" fill="#343C54"/>
</svg> 


  <% } %>

                        </button>
                        <button class="btn btn-ghost btn-sm" 
                                onclick="toggleStatus('<%= product._id %>', '<%= product.name %>', `<%= !product.isActive %>`)"
                                title="<%= product.isActive ? 'Deactivate' : 'Activate' %>">
                           <% if(product.isActive) { %>  
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 1.25C9.37665 1.25 7.25 3.37665 7.25 6V8.69562C5.57125 10.071 4.5 12.1604 4.5 14.5C4.5 18.6421 7.85786 22 12 22C16.1421 22 19.5 18.6421 19.5 14.5C19.5 12.1604 18.4288 10.071 16.75 8.69562V6C16.75 3.37665 14.6234 1.25 12 1.25ZM12 7C10.8356 7 9.73325 7.26533 8.75 7.73883V6C8.75 4.20507 10.2051 2.75 12 2.75C13.7949 2.75 15.25 4.20507 15.25 6V7.73883C14.2667 7.26533 13.1644 7 12 7ZM12 8.5C15.3137 8.5 18 11.1863 18 14.5C18 17.8137 15.3137 20.5 12 20.5C8.68629 20.5 6 17.8137 6 14.5C6 11.1863 8.68629 8.5 12 8.5Z" fill="#323544"/>
<path opacity="0.4" d="M12.75 15.5C12.75 15.0858 12.4142 14.75 12 14.75C11.5858 14.75 11.25 15.0858 11.25 15.5V17.5C11.25 17.9142 11.5858 18.25 12 18.25C12.4142 18.25 12.75 17.9142 12.75 17.5V15.5Z" fill="#323544"/>
</svg>

                            <% } else { %>
<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2C9.10051 2 6.75 4.35051 6.75 7.25V9.125H5.5C4.25736 9.125 3.25 10.1324 3.25 11.375V17.2495C3.25 19.8729 5.37665 21.9995 8 21.9995H16C18.6234 21.9995 20.75 19.8729 20.75 17.2495V11.375C20.75 10.1324 19.7426 9.125 18.5 9.125H8.25V7.25C8.25 5.17893 9.92893 3.5 12 3.5C13.4184 3.5 14.6541 4.28724 15.2919 5.45221C15.4909 5.81553 15.9466 5.9488 16.31 5.74987C16.6733 5.55095 16.8066 5.09516 16.6076 4.73184C15.7172 3.10553 13.9882 2 12 2ZM7.47268 10.625C7.48175 10.6253 7.49085 10.6255 7.5 10.6255C7.50915 10.6255 7.51825 10.6253 7.52732 10.625H18.5C18.9142 10.625 19.25 10.9608 19.25 11.375V17.2495C19.25 19.0444 17.7949 20.4995 16 20.4995H8C6.20507 20.4995 4.75 19.0444 4.75 17.2495V11.375C4.75 10.9608 5.08579 10.625 5.5 10.625H7.47268Z" fill="#323544"/>
<path opacity="0.4" d="M10.5 16C10.5 15.1716 11.1716 14.5 12 14.5C12.8284 14.5 13.5 15.1716 13.5 16V17.5C13.5 18.3284 12.8284 19 12 19C11.1716 19 10.5 18.3284 10.5 17.5V16Z" fill="#323544"/>
</svg>

                              <% } %>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>


            <div class="card-view">
              <% products.forEach((product) => { %>
              <div class="product-card">
                <div class="card-header">
                  <div class="product-image">
                    <% if (product.images && product.images.length > 0) { %>
                      <img src="<%= product.images[0] %>" alt="<%= product.name %>" loading="lazy">
                    <% } else { %>
                      <div class="image-placeholder">
                        <i class="icon-image"></i>
                      </div>
                    <% } %>
                    <% if (product.isFeatured) { %>
                      <span class="featured-badge">
                        <i class="icon-star"></i>
                      </span>
                    <% } %>
                  </div>
                  <div class="card-info">
                    <h3 class="product-name"><%= product.name %></h3>
                    <% if (product.brand) { %>
                      <span class="product-brand"><%= product.brand.name %></span>
                    <% } %>
                    <div class="price-info">
                      <span class="regular-price">$<%= product.regularPrice.toFixed(2) %></span>
                      <% if (product.salePrice > 0 && product.salePrice < product.regularPrice) { %>
                        <span class="sale-price">$<%= product.salePrice.toFixed(2) %></span>
                      <% } %>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div class="card-stats">
                    <div class="stat-item">
                      <span class="stat-label">Stock</span>
                      <span class="stock-badge <%= product.stock <= 10 ? 'low-stock' : product.stock <= 0 ? 'out-of-stock' : 'in-stock' %>">
                        <%= product.stock %>
                      </span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Category</span>
                      <% if (product.category) { %>
                        <span class="category-tag"><%= product.category.name %></span>
                      <% } %>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Status</span>
                      <span class="status-badge <%= product.isActive ? 'active' : 'inactive' %>">
                        <%= product.isActive ? 'Active' : 'Inactive' %>
                      </span>
                    </div>
                  </div>
                </div>
                <div class="card-actions">
                  <a href="/admin/products/edit/<%= product._id %>" class="btn btn-ghost btn-sm">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M19.3028 3.7801C18.4241 2.90142 16.9995 2.90142 16.1208 3.7801L14.3498 5.5511C14.3442 5.55633 14.3387 5.56166 14.3333 5.5671C14.3279 5.57253 14.3225 5.57803 14.3173 5.58359L5.83373 14.0672C5.57259 14.3283 5.37974 14.6497 5.27221 15.003L4.05205 19.0121C3.9714 19.2771 4.04336 19.565 4.23922 19.7608C4.43508 19.9567 4.72294 20.0287 4.98792 19.948L8.99703 18.7279C9.35035 18.6203 9.67176 18.4275 9.93291 18.1663L20.22 7.87928C21.0986 7.0006 21.0986 5.57598 20.22 4.6973L19.3028 3.7801ZM14.8639 7.15833L6.89439 15.1278C6.80735 15.2149 6.74306 15.322 6.70722 15.4398L5.8965 18.1036L8.56029 17.2928C8.67806 17.257 8.7852 17.1927 8.87225 17.1057L16.8417 9.13619L14.8639 7.15833ZM17.9024 8.07553L19.1593 6.81862C19.4522 6.52572 19.4522 6.05085 19.1593 5.75796L18.2421 4.84076C17.9492 4.54787 17.4743 4.54787 17.1814 4.84076L15.9245 6.09767L17.9024 8.07553Z" fill="#323544"/>
</svg>

                  </a>
                  <button class="btn btn-ghost btn-sm" 
                          onclick="toggleFeatured('<%= product._id %>', '<%= product.name %>', `<%= !product.isFeatured %>`)">
                    <i class="icon-<%= product.isFeatured ? 'star-filled' : 'star' %>"></i>
                  </button>
                  <button class="btn btn-ghost btn-sm" 
                          onclick="toggleStatus('<%= product._id %>', '<%= product.name %>', `<%= !product.isActive %>`)">
                    <i class="icon-<%= product.isActive ? 'eye-off' : 'eye' %>"></i>
                  </button>
                </div>
              </div>
              <% }) %>
            </div>
          <% } else { %>
            <div class="empty-state">
              <div class="empty-icon">
                <i class="icon-package"></i>
              </div>
              <h3>No products found</h3>
              <p>Get started by adding your first product</p>
              <% if (search || status !== 'all' || categoryFilter !== 'all' || brandFilter !== 'all') { %>
                <button class="btn btn-ghost" onclick="resetFilters()">Clear filters</button>
              <% } else { %>
                <a href="/admin/products/create" class="btn btn-primary">
                  <i class="icon-plus"></i>
                  <span>Add Product</span>
                </a>
              <% } %>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Confirmation Modal -->
<div class="modal-overlay" id="confirm-modal">
  <div class="modal-container">
    <div class="modal-header">
      <h3 id="confirm-title">Confirm Action</h3>
      <button class="modal-close" onclick="closeConfirmModal()">
        <i class="icon-x"></i>
      </button>
    </div>
    <div class="modal-body">
      <p id="confirm-message">Are you sure you want to perform this action?</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeConfirmModal()">Cancel</button>
      <button class="btn btn-danger" id="confirm-button" onclick="confirmAction()">Confirm</button>
    </div>
  </div>
</div>

<style>


:root {
  --primary: #08090b;
  --primary-hover: #0e0f11;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --gray-50: #f9fafb;
  --gray-100: #f3f4f6;
  --gray-200: #e5e7eb;
  --gray-300: #d1d5db;
  --gray-400: #9ca3af;
  --gray-500: #6b7280;
  --gray-600: #4b5563;
  --gray-700: #374151;
  --gray-800: #1f2937;
  --gray-900: #111827;
  --white: #ffffff;
  --radius: 8px;
  --radius-lg: 12px;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--gray-50);
  color: var(--gray-900);
  line-height: 1.5;
}

.products-management {
  min-height: 100vh;
  padding: 1rem;
}

.container-fluid {
  max-width: 1400px;
  margin: 0 auto;
}

.content-wrapper {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.page-card {
  background: var(--white);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow);
  overflow: hidden;
}

/* Header */
.page-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem 2rem;
  border-bottom: 1px solid var(--gray-200);
  background: var(--white);
}

.header-content {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.page-title {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--gray-900);
}

.stats-row {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
}

.stat-badge {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.stat-number {
  font-weight: 600;
  color: var(--gray-900);
}

.stat-label {
  color: var(--gray-500);
}

.stat-divider {
  color: var(--gray-300);
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border: none;
  border-radius: var(--radius);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  white-space: nowrap;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-primary {
  background: var(--primary);
  color: var(--white);
}

.btn-primary:hover:not(:disabled) {
  background: var(--primary-hover);
}

.btn-ghost {
  background: transparent;
  color: var(--gray-600);
  border: 1px solid var(--gray-200);
}

.btn-ghost:hover:not(:disabled) {
  background: var(--gray-50);
  color: var(--gray-900);
}

.btn-danger {
  color: var(--danger);
}

.btn-danger:hover:not(:disabled) {
  background: var(--danger);
  color: var(--white);
}

.btn-sm {
  padding: 0.375rem 0.75rem;
  font-size: 0.8125rem;
}

.btn-add {
  padding: 0.75rem 1.5rem;
}

/* Messages */
.message-container {
  padding: 0 2rem;
}

.alert {
  padding: 0.75rem 1rem;
  border-radius: var(--radius);
  font-size: 0.875rem;
  display: none;
  margin: 1rem 0;
}

.alert.show {
  display: block;
}

.alert-error {
  background: #fef2f2;
  color: #991b1b;
  border: 1px solid #fecaca;
}

.alert-success {
  background: #f0fdf4;
  color: #166534;
  border: 1px solid #bbf7d0;
}

/* Controls Panel */
.controls-panel {
  padding: 1.5rem 2rem;
  border-bottom: 1px solid var(--gray-200);
  background: var(--gray-50);
}

.filters-grid {
  display: grid;
  grid-template-columns: 2fr repeat(4, 1fr) auto;
  gap: 1rem;
  align-items: end;
}

.filter-item {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.filter-label {
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--gray-700);
}

.search-filter {
  grid-column: 1;
}

.search-wrapper {
  display: flex;
  border: 1px solid var(--gray-300);
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--white);
}

.search-input {
  flex: 1;
  padding: 0.75rem 1rem;
  border: none;
  outline: none;
  font-size: 0.875rem;
}

.search-btn {
  padding: 0.75rem;
  background: var(--primary);
  color: var(--white);
  border: none;
  cursor: pointer;
  transition: background-color 0.2s;
}

.search-btn:hover {
  background: var(--primary-hover);
}

.filter-select {
  padding: 0.75rem 1rem;
  border: 1px solid var(--gray-300);
  border-radius: var(--radius);
  background: var(--white);
  font-size: 0.875rem;
  cursor: pointer;
}

.filter-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
}

.sort-controls {
  display: flex;
  gap: 0.5rem;
}

.sort-toggle {
  padding: 0.75rem;
  border: 1px solid var(--gray-300);
  border-radius: var(--radius);
  background: var(--white);
  cursor: pointer;
  transition: all 0.2s;
}

.sort-toggle:hover {
  background: var(--gray-50);
}

/* Pagination */
.pagination-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem 2rem;
  border-bottom: 1px solid var(--gray-200);
}

.pagination-info {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  color: var(--gray-600);
}

.page-input {
  width: 4rem;
  padding: 0.375rem 0.5rem;
  border: 1px solid var(--gray-300);
  border-radius: var(--radius);
  text-align: center;
  font-size: 0.875rem;
}

.pagination-controls {
  display: flex;
  gap: 0.5rem;
}

/* Products Container */
.products-container {
  padding: 2rem;
}

/* Table View */
.table-view {
  display: block;
}

.products-table {
  width: 100%;
  border-collapse: collapse;
}

.products-table th {
  padding: 0.75rem 1rem;
  text-align: left;
  font-size: 0.8125rem;
  font-weight: 600;
  color: var(--gray-700);
  background: var(--gray-50);
  border-bottom: 1px solid var(--gray-200);
}

.products-table td {
  padding: 1rem;
  border-bottom: 1px solid var(--gray-100);
  vertical-align: top;
}

.sortable {
  cursor: pointer;
  user-select: none;
  transition: background-color 0.2s;
}

.sortable:hover {
  background: var(--gray-100);
}

.sortable span {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.sort-icon {
  font-size: 0.75rem;
  color: var(--primary);
}

/* Product Cells */
.product-cell {
  min-width: 250px;
}

.product-info {
  display: flex;
  gap: 1rem;
  align-items: center;
}

.product-image {
  position: relative;
  width: 3rem;
  height: 3rem;
  border-radius: var(--radius);
  overflow: hidden;
  background: var(--gray-100);
  flex-shrink: 0;
}

.product-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gray-400);
  font-size: 1.25rem;
}

.featured-badge {
  position: absolute;
  top: -0.25rem;
  right: -0.25rem;
  width: 1rem;
  height: 1rem;
  background: var(--warning);
  color: var(--white);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.625rem;
}

.product-details {
  flex: 1;
  min-width: 0;
}

.product-name {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--gray-900);
  margin-bottom: 0.25rem;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.product-brand {
  font-size: 0.75rem;
  color: var(--gray-500);
}

.price-cell {
  min-width: 120px;
}

.price-info {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.regular-price {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--gray-900);
}

.sale-price {
  font-size: 0.75rem;
  color: var(--danger);
  text-decoration: line-through;
}

.discount-badge {
  font-size: 0.625rem;
  padding: 0.125rem 0.375rem;
  background: var(--danger);
  color: var(--white);
  border-radius: 0.25rem;
  width: fit-content;
}

.stock-cell {
  min-width: 80px;
}

.stock-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.375rem;
  font-size: 0.75rem;
  font-weight: 500;
}

.stock-badge.in-stock {
  background: #d1fae5;
  color: #065f46;
}

.stock-badge.low-stock {
  background: #fef3c7;
  color: #92400e;
}

.stock-badge.out-of-stock {
  background: #fee2e2;
  color: #991b1b;
}

.category-cell {
  min-width: 100px;
}

.category-tag {
  padding: 0.25rem 0.5rem;
  background: var(--gray-100);
  color: var(--gray-700);
  border-radius: 0.375rem;
  font-size: 0.75rem;
}

.status-cell {
  min-width: 80px;
}





.actions-cell {
  min-width: 150px;
}

.action-buttons {
  display: flex;
  gap: 0.25rem;
}

/* Card View (Mobile) */
.card-view {
  display: none;
  grid-template-columns: 1fr;
  gap: 1rem;
}

.product-card {
  background: var(--white);
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: box-shadow 0.2s;
}

.product-card:hover {
  box-shadow: var(--shadow-lg);
}

.card-header {
  display: flex;
  gap: 1rem;
  padding: 1rem;
}

.card-info {
  flex: 1;
  min-width: 0;
}

.card-body {
  padding: 0 1rem 1rem;
}

.card-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.stat-item {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.stat-label {
  font-size: 0.75rem;
  color: var(--gray-500);
}

.card-actions {
  display: flex;
  gap: 0.5rem;
  padding: 1rem;
  border-top: 1px solid var(--gray-100);
  background: var(--gray-50);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 4rem 2rem;
}

.empty-icon {
  font-size: 4rem;
  color: var(--gray-300);
  margin-bottom: 1rem;
}

.empty-state h3 {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--gray-900);
  margin-bottom: 0.5rem;
}

.empty-state p {
  color: var(--gray-500);
  margin-bottom: 1.5rem;
}

/* Modal Styles */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal-container {
  background: var(--white);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow: hidden;
  transform: scale(0.95);
  transition: transform 0.3s ease;
}

.modal-overlay.active .modal-container {
  transform: scale(1);
}

.modal-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem 2rem;
  border-bottom: 1px solid var(--gray-200);
}

.modal-header h3 {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--gray-900);
}

.modal-close {
  padding: 0.5rem;
  background: none;
  border: none;
  color: var(--gray-400);
  cursor: pointer;
  border-radius: var(--radius);
  transition: all 0.2s;
}

.modal-close:hover {
  background: var(--gray-100);
  color: var(--gray-600);
}

.modal-body {
  padding: 2rem;
  max-height: 60vh;
  overflow-y: auto;
}

.modal-footer {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--gray-200);
  background: var(--gray-50);
}

/* Loading Styles */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.9);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.loading-overlay.active {
  opacity: 1;
  visibility: visible;
}

.loading-spinner {
  text-align: center;
}

.spinner {
  width: 2rem;
  height: 2rem;
  border: 2px solid var(--gray-200);
  border-top: 2px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 1rem;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Icon Styles */
[class^="icon-"], [class*=" icon-"] {
  font-family: 'Lucide';
  font-style: normal;
  font-weight: normal;
  font-variant: normal;
  text-transform: none;
  line-height: 1;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.icon-plus:before { content: "+"; }
.icon-search:before { content: "🔍"; }
.icon-edit:before { content: "✏️"; }
.icon-trash:before { content: "🗑️"; }
.icon-star:before { content: "☆"; }
.icon-star-filled:before { content: "★"; }
.icon-eye:before { content: "👁️"; }
.icon-eye-off:before { content: "🙈"; }
.icon-chevron-left:before { content: "‹"; }
.icon-chevron-right:before { content: "›"; }
.icon-arrow-up:before { content: "↑"; }
.icon-arrow-down:before { content: "↓"; }
.icon-refresh:before { content: "🔄"; }
.icon-x:before { content: "×"; }
.icon-package:before { content: "📦"; }

/* Responsive Design */
@media (max-width: 1024px) {
  .filters-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .search-filter {
    grid-column: 1;
  }
}

@media (max-width: 768px) {
  .products-management {
    padding: 0.5rem;
  }
  
  .page-header {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .header-content {
    justify-content: space-between;
  }
  
  .controls-panel {
    padding: 1rem;
  }
  
  .pagination-wrapper {
    flex-direction: column;
    gap: 1rem;
    align-items: stretch;
  }
  
  .products-container {
    padding: 1rem;
  }
  
  .table-view {
    display: none;
  }
  
  .card-view {
    display: grid;
  }
}

@media (max-width: 480px) {
  .page-title {
    font-size: 1.25rem;
  }
  
  .stats-row {
    font-size: 0.75rem;
  }
  
  .btn {
    padding: 0.5rem 0.75rem;
    font-size: 0.8125rem;
  }
  
  .card-stats {
    grid-template-columns: 1fr;
  }
  
  .card-actions {
    flex-wrap: wrap;
  }
}
</style>

<script>
const BASE_URL = window.location.origin;

// Global State
const STATE = {
  page: parseInt('<%= currentPage %>') || 1,
  status: '<%= status %>' || 'all',
  categoryFilter: '<%= categoryFilter %>' || 'all',
  brandFilter: '<%= brandFilter %>' || 'all',
  sortField: '<%= sortField %>' || 'createdAt',
  sortOrder: '<%= sortOrder %>' || 'desc',
  search: '<%= search %>' || '',
  pendingAction: null,
  isLoading: false
};

// Utility Functions
function showLoading() {
  STATE.isLoading = true;
  document.getElementById('loading-overlay').classList.add('active');
}

function hideLoading() {
  STATE.isLoading = false;
  document.getElementById('loading-overlay').classList.remove('active');
}

function showError(message) {
  const errorMsg = document.getElementById('error-msg');
  if (errorMsg) {
    errorMsg.textContent = message;
    errorMsg.classList.add('show');
    setTimeout(() => {
      errorMsg.classList.remove('show');
    }, 5000);
  }
}

function showSuccess(message) {
  const successMsg = document.getElementById('success-msg');
  if (successMsg) {
    successMsg.textContent = message;
    successMsg.classList.add('show');
    setTimeout(() => {
      successMsg.classList.remove('show');
    }, 5000);
  }
}

function buildUrl(overrides = {}) {
  const params = {
    page: overrides.page || STATE.page,
    status: overrides.status || STATE.status,
    categoryFilter: overrides.categoryFilter || STATE.categoryFilter,
    brandFilter: overrides.brandFilter || STATE.brandFilter,
    sortField: overrides.sortField || STATE.sortField,
    sortOrder: overrides.sortOrder || STATE.sortOrder,
    search: overrides.search !== undefined ? overrides.search : STATE.search
  };

  Object.keys(params).forEach(key => {
    if (params[key] === '' || params[key] === null || params[key] === undefined || 
        params[key] === 'all') {
      delete params[key];
    }
  });

  const url = new URL(window.location.pathname, window.location.origin);
  Object.keys(params).forEach(key => {
    url.searchParams.set(key, params[key]);
  });

  return url.toString();
}

function navigateToUrl(url) {
  showLoading();
  window.location.href = url;
}

// Navigation Functions
function goToPage(page) {
  const pageNum = parseInt(page);
  const maxPages = parseInt('<%= totalPages %>');
  if (pageNum < 1 || pageNum > maxPages) return;
  
  STATE.page = pageNum;
  navigateToUrl(buildUrl({ page: pageNum }));
}

function setSortField(field) {
  const newOrder = (STATE.sortField === field && STATE.sortOrder === 'asc') ? 'desc' : 'asc';
  STATE.sortField = field;
  STATE.sortOrder = newOrder;
  STATE.page = 1;
  navigateToUrl(buildUrl({ sortField: field, sortOrder: newOrder, page: 1 }));
}

function resetFilters() {
  STATE.page = 1;
  STATE.status = 'all';
  STATE.categoryFilter = 'all';
  STATE.brandFilter = 'all';
  STATE.sortField = 'createdAt';
  STATE.sortOrder = 'desc';
  STATE.search = '';
  
  navigateToUrl(buildUrl({
    page: 1,
    status: 'all',
    categoryFilter: 'all',
    brandFilter: 'all',
    sortField: 'createdAt',
    sortOrder: 'desc',
    search: ''
  }));
}

// Modal Functions
function showConfirmModal(title, message, confirmText, confirmCallback) {
  document.getElementById('confirm-title').textContent = title;
  document.getElementById('confirm-message').textContent = message;
  document.getElementById('confirm-button').textContent = confirmText;
  STATE.pendingAction = confirmCallback;
  document.getElementById('confirm-modal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeConfirmModal() {
  document.getElementById('confirm-modal').classList.remove('active');
  document.body.style.overflow = '';
  STATE.pendingAction = null;
}

function confirmAction() {
  if (STATE.pendingAction) {
    STATE.pendingAction();
    closeConfirmModal();
  }
}

// Product Action Functions
function toggleFeatured(productId, productName, featured) {
  const action = featured == 'true' ? 'unfeature' : 'feature';
  showConfirmModal(
    `${action.charAt(0).toUpperCase() + action.slice(1)} Product`,
    `Are you sure you want to ${action} "${productName}"?`,
    action.charAt(0).toUpperCase() + action.slice(1),
    () => performToggleFeatured(productId, featured)
  );
}

function toggleStatus(productId, productName, activate) {
  const action = activate == 'true' ? 'activate' : 'deactivate';
  showConfirmModal(
    `${action.charAt(0).toUpperCase() + action.slice(1)} Product`,
    `Are you sure you want to ${action} "${productName}"?`,
    action.charAt(0).toUpperCase() + action.slice(1),
    () => performToggleStatus(productId, activate)
  );
}



// API Calls
async function performToggleFeatured(productId, featured) {
  if (STATE.isLoading) return;
  showLoading();
  
  try {
    const response = await fetch(`${BASE_URL}/admin/products/toggle-featured/${productId}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ featured: featured })
    });
    
    const data = await response.json();
    
    if (data.success) {
      window.location.reload();
    } else {
      hideLoading();
      showError(data.message || 'Failed to update product');
    }
  } catch (error) {
    hideLoading();
    showError('An error occurred while updating the product');
    console.error('Error:', error);
  }
}

async function performToggleStatus(productId, active) {
  if (STATE.isLoading) return;
  showLoading();
  
  try {
    const response = await fetch(`${BASE_URL}/admin/products/toggle-status/${productId}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ active: active })
    });
    
    const data = await response.json();
    
    if (data.success) {
      window.location.reload();
    } else {
      hideLoading();
      showError(data.message || 'Failed to update product');
    }
  } catch (error) {
    hideLoading();
    showError('An error occurred while updating the product');
    console.error('Error:', error);
  }
}



// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
  // Filter event listeners
  document.getElementById('status-filter').addEventListener('change', function(e) {
    STATE.status = e.target.value;
    STATE.page = 1;
    navigateToUrl(buildUrl({ status: e.target.value, page: 1 }));
  });

  document.getElementById('category-filter').addEventListener('change', function(e) {
    STATE.categoryFilter = e.target.value;
    STATE.page = 1;
    navigateToUrl(buildUrl({ categoryFilter: e.target.value, page: 1 }));
  });

  document.getElementById('brand-filter').addEventListener('change', function(e) {
    STATE.brandFilter = e.target.value;
    STATE.page = 1;
    navigateToUrl(buildUrl({ brandFilter: e.target.value, page: 1 }));
  });

  document.getElementById('sort-field').addEventListener('change', function(e) {
    STATE.sortField = e.target.value;
    STATE.page = 1;
    navigateToUrl(buildUrl({ sortField: e.target.value, page: 1 }));
  });

  document.getElementById('sort-order').addEventListener('click', function() {
    const newOrder = STATE.sortOrder === 'asc' ? 'desc' : 'asc';
    STATE.sortOrder = newOrder;
    STATE.page = 1;
    navigateToUrl(buildUrl({ sortOrder: newOrder, page: 1 }));
  });

  document.getElementById('search-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const searchValue = document.getElementById('search-input').value.trim();
    STATE.search = searchValue;
    STATE.page = 1;
    navigateToUrl(buildUrl({ search: searchValue, page: 1 }));
  });

  document.getElementById('reset-filters').addEventListener('click', resetFilters);

  document.getElementById('page-input').addEventListener('change', function(e) {
    const value = parseInt(e.target.value);
    const maxPages = parseInt('<%= totalPages %>');
    if (value >= 1 && value <= maxPages) {
      goToPage(value);
    }
  });

  // Modal event listeners
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      if (document.getElementById('confirm-modal').classList.contains('active')) {
        closeConfirmModal();
      }
    }
  });

  // Close modals on backdrop click
  document.getElementById('confirm-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeConfirmModal();
    }
  });
});

// Handle browser navigation
window.addEventListener('popstate', function() {
  if (!STATE.isLoading) {
    window.location.reload();
  }
});

// Hide loading on page load
window.addEventListener('load', function() {
  hideLoading();
});
</script>