<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>My Account – <%= user.name %></title>

  <!-- libs -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <!-- page-specific style -->
  <style>
    :root{
      --up-primary:#000;
      --up-light:#f9f9f9;
      --up-medium:#e5e5e5;
      --up-dark:#555;
      --up-round:8px;
      --up-trans:.3s;
    }
    body{font-family:'Nunito Sans',sans-serif;background:#fff;color:#333;}

    /* wrapper */
    #up-page{padding:2rem 0;}

    /* avatar card */
    .up-avatar{width:110px;height:110px;border-radius:50%;object-fit:cover;border:3px solid var(--up-medium);}
    .up-card{border:1px solid var(--up-medium);border-radius:var(--up-round);background:#fff;}
    .up-card-header{background:var(--up-light);padding:.75rem 1.25rem;border-bottom:1px solid var(--up-medium);font-weight:600;}

    /* action links */
    .up-action a{display:inline-block;margin:0 .25rem .5rem 0;}

    /* address chips */
    .up-address{border:1px solid var(--up-medium);border-radius:var(--up-round);padding:1rem;margin-bottom:1rem;position:relative;}
    .up-address-default{position:absolute;top:8px;right:8px;background:#28a745;color:#fff;font-size:12px;padding:2px 6px;border-radius:var(--up-round);}

    /* orders table */
    .up-orders th, .up-orders td{vertical-align:middle;}
    .up-status{font-size:.875rem;padding:.25rem .5rem;border-radius:var(--up-round);}
    .up-pending{background:#ffecb3;}
    .up-shipped{background:#c8e6c9;}
    .up-cancelled{background:#ffcdd2;}

    /* responsive tweaks */
    @media(max-width:767px){
      .up-avatar{width:80px;height:80px;}
      .up-orders th:nth-child(4),.up-orders td:nth-child(4){display:none;}/* hide date on xs */
    }
  </style>
</head>
<body>

  <main id="up-page" class="container">

    <!-- PROFILE HEADER -->
    <div class="d-flex align-items-center mb-4 flex-wrap">
      <img class="up-avatar mr-3 mb-2" src="<%= user.profileImage||'/img/no-avatar.png' %>" alt="Avatar"/>
      <div>
        <h2 class="mb-1"><%= user.name %></h2>
        <p class="text-muted mb-0"><%= user.email %></p>
      </div>
      <div class="ml-auto up-action">
        <a href="/profile/edit" class="btn btn-sm btn-outline-primary"><i class="fas fa-user-edit"></i> Edit Profile</a>
        <a href="/profile/password" class="btn btn-sm btn-outline-secondary"><i class="fas fa-key"></i> Change Password</a>
        <a href="/logout" class="btn btn-sm btn-outline-danger"><i class="fas fa-sign-out-alt"></i> Logout</a>
      </div>
    </div>

    <!-- GRID -->
    <div class="row">

      <!-- LEFT: Addresses -->
      <div class="col-lg-4 mb-4">
        <div class="up-card h-100">
          <div class="up-card-header d-flex justify-content-between align-items-center">
            Addresses
            <a href="#" data-toggle="modal" data-target="#addAddr" class="btn btn-sm btn-primary">Add</a>
          </div>
          <div class="p-3">
            <% if(addresses.length){ addresses.forEach(addr=>{ %>
              <div class="up-address">
                <% if(addr.isDefault){ %><span class="up-address-default">Default</span><% } %>
                <p class="mb-1 font-weight-bold"><%= addr.fullName %> </p>
                <p class="mb-1"><%= addr.street %>, <%= addr.city %>, <%= addr.state %> – <%= addr.zip %></p>
                <p class="mb-1"><%= addr.phone %></p>
                <div>
                  <a href="/address/<%= addr._id %>/edit" class="text-primary mr-2"><i class="fas fa-edit"></i></a>
                  <a href="/address/<%= addr._id %>/delete" class="text-danger"><i class="fas fa-trash"></i></a>
                </div>
              </div>
            <% }) } else { %>
              <p class="text-muted">No addresses yet.</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- RIGHT: Orders -->
      <div class="col-lg-8 mb-4">
        <div class="up-card">
          <div class="up-card-header">Recent Orders</div>
          <div class="table-responsive">
            <table class="table up-orders mb-0">
              <thead>
                <tr>
                  <th>Order&nbsp;ID</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Date</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% if(orders.length){ orders.forEach(o=>{ %>
                  <tr>
                    <td><%= o.orderId %></td>
                    <td>
                      <span class="up-status up-<%= o.status %>"><%= o.status %></span>
                    </td>
                    <td>$<%= o.total.toFixed(2) %></td>
                    <td><%= new Date(o.createdAt).toLocaleDateString() %></td>
                    <td><a href="/orders/<%= o._id %>" class="btn btn-sm btn-outline-info">View</a></td>
                  </tr>
                <% }) } else { %>
                  <tr><td colspan="5" class="text-center text-muted">No orders found.</td></tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </main>


  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>
