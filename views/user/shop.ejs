

<style>
    .regular-price {
  text-decoration: line-through !important;
}

.sale-price {
    font-weight: 800;
}
</style>
    
    
    <style>
        .shop-filters {
            background: #f8f9fa;
            padding: 20px 0;
            border-bottom: 1px solid #eee;
        }
        
        .filter-dropdown {
            position: relative;
            display: inline-block;
            margin-right: 15px;
            margin-bottom: 10px;
        }
        
        .filter-dropdown select {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 15px;
            border-radius: 4px;
            min-width: 120px;
        }
        
        .search-box {
            position: relative;
            max-width: 300px;
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .search-box button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            padding: 5px 10px;
        }
        
        .sidebar-filters {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .filter-group {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .filter-group:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .filter-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .price-range {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .price-range label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
        }
        
        .price-range input {
            margin-right: 8px;
        }
        
        .size-options, .rating-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .size-btn, .rating-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            color: #333;
        }
        
        .size-btn.active, .rating-btn.active {
            background: #ca1515;
            color: white;
            border-color: #ca1515;
        }
        
        .mobile-filter-btn {
            display: none;
            background: #ca1515;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .mobile-filter-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .mobile-filter-sidebar {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background: white;
            z-index: 1001;
            transition: left 0.3s ease;
            overflow-y: auto;
            padding: 20px;
        }
        
        .mobile-filter-sidebar.active {
            left: 0;
        }
        
        .close-mobile-filter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        .sort-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .results-info {
            color: #666;
            font-size: 14px;
        }
        
        .sort-dropdown select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        
        .pagination-wrapper {
            display: flex;
            justify-content: center;
            margin-top: 40px;
        }
        
        .pagination {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .pagination li {
            margin: 0 2px;
        }
        
        .pagination a {
            display: block;
            padding: 8px 12px;
            text-decoration: none;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .pagination .active a {
            background: #ca1515;
            color: white;
            border-color: #ca1515;
        }
        
        .pagination a:hover {
            background: #f8f9fa;
        }
        
        @media (max-width: 768px) {
            .mobile-filter-btn {
                display: block;
            }
            
            .desktop-sidebar {
                display: none;
            }
            
            .shop-filters {
                padding: 15px 0;
            }
            
            .filter-dropdown {
                width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .filter-dropdown select {
                width: 100%;
            }
            
            .sort-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .product__item__text h6 {
                font-size: 14px;
            }
        }
    </style>

    
    <section class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__text">
                        <h4>Shop</h4>
                        <div class="breadcrumb__links">
                            <a href="/">Home</a>
                            <span>Shop</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="shop-filters">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">

                    <div class="search-box">
                        <form method="GET" action="/user/products/shop">
                            <input type="text" name="search" placeholder="Search products..." value="<%= search || '' %>">
                            <button type="submit"><i class="fa fa-search"></i></button>
                            <% if (category) { %><input type="hidden" name="category" value="<%= category %>"><% } %>
                            <% if (brand) { %><input type="hidden" name="brand" value="<%= brand %>"><% } %>
                            <% if (priceRange) { %><input type="hidden" name="priceRange" value="<%= priceRange %>"><% } %>
                            <% if (size) { %><input type="hidden" name="size" value="<%= size %>"><% } %>
                            <% if (color) { %><input type="hidden" name="color" value="<%= color %>"><% } %>
                            <% if (rating) { %><input type="hidden" name="rating" value="<%= rating %>"><% } %>
                            <input type="hidden" name="sortBy" value="<%= sortBy %>">
                        </form>
                    </div>
                    
                    <div class="horizontal-filters">
                        <!-- Category Filter -->
                        <div class="filter-dropdown">
                            <select name="category" onchange="updateFilter('category', this.value)">
                                <option value="">All Categories</option>
                                <% categories.forEach(cat => { %>
                                    <option value="<%= cat._id %>" <%= category === cat._id ? 'selected' : '' %>>
                                        <%= cat.name %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>
                        
                        <!-- Brand Filter -->
                        <div class="filter-dropdown">
                            <select name="brand" onchange="updateFilter('brand', this.value)">
                                <option value="">All Brands</option>
                                <% brands.forEach(brandItem => { %>
                                    <option value="<%= brandItem._id %>" <%= brand === brandItem._id ? 'selected' : '' %>>
                                        <%= brandItem.name %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>
                        
                        <!-- Color Filter -->
                        <div class="filter-dropdown">
                            <select name="color" onchange="updateFilter('color', this.value)">
                                <option value="">All Colors</option>
                                <% colors.forEach(colorItem => { %>
                                    <option value="<%= colorItem %>" <%= color === colorItem ? 'selected' : '' %>>
                                        <%= colorItem %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="shop spad">
        <div class="container">
            <div class="row">
                <!-- Mobile Filter Button -->
                <div class="col-lg-12">
                    <button class="mobile-filter-btn" onclick="toggleMobileFilter()">
                        <i class="fa fa-filter"></i> Filters
                    </button>
                </div>
                
                <!-- Desktop Sidebar -->
                <div class="col-lg-3 desktop-sidebar">
                    <div class="sidebar-filters">
                        <!-- Price Filter -->
                        <div class="filter-group">
                            <h5 class="filter-title">Price Range</h5>
                            <div class="price-range">
                                <label>
                                    <input type="radio" name="priceRange" value="" <%= !priceRange ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    All Prices
                                </label>
                                <label>
                                    <input type="radio" name="priceRange" value="0-50" <%= priceRange === '0-50' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    $0 - $50
                                </label>
                                <label>
                                    <input type="radio" name="priceRange" value="50-100" <%= priceRange === '50-100' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    $50 - $100
                                </label>
                                <label>
                                    <input type="radio" name="priceRange" value="100-150" <%= priceRange === '100-150' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    $100 - $150
                                </label>
                                <label>
                                    <input type="radio" name="priceRange" value="150-200" <%= priceRange === '150-200' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    $150 - $200
                                </label>
                                <label>
                                    <input type="radio" name="priceRange" value="200-plus" <%= priceRange === '200-plus' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                                    $200+
                                </label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <h5 class="filter-title">Size</h5>
                            <div class="size-options">
                                <% sizes.forEach(sizeItem => { %>
                                    <a href="#" class="size-btn <%= size === sizeItem ? 'active' : '' %>" 
                                       onclick="updateFilter('size', '<%= sizeItem %>')">
                                        <%= sizeItem %>
                                    </a>
                                <% }) %>
                            </div>
                        </div>
                        
                        <!-- Rating Filter -->
                        <div class="filter-group">
                            <h5 class="filter-title">Rating</h5>
                            <div class="rating-options">
                                <a href="#" class="rating-btn <%= rating === '4' ? 'active' : '' %>" 
                                   onclick="updateFilter('rating', '4')">
                                    4+ Stars
                                </a>
                                <a href="#" class="rating-btn <%= rating === '3' ? 'active' : '' %>" 
                                   onclick="updateFilter('rating', '3')">
                                    3+ Stars
                                </a>
                                <a href="#" class="rating-btn <%= rating === '2' ? 'active' : '' %>" 
                                   onclick="updateFilter('rating', '2')">
                                    2+ Stars
                                </a>
                            </div>
                        </div>
                        
                        <!-- Clear Filters -->
                        <div class="filter-group">
                            <a href="/user/products/shop" class="btn btn-outline-secondary btn-sm">Clear All Filters</a>
                        </div>
                    </div>
                </div>
                
                <!-- Products -->
                <div class="col-lg-9">
                    <!-- Sort Controls -->
                    <div class="sort-controls">
                        <div class="results-info">
                            Showing <%= ((currentPage - 1) * limit) + 1 %>-<%= Math.min(currentPage * limit, totalProducts) %> 
                            of <%= totalProducts %> products
                        </div>
                        <div class="sort-dropdown">
                            <select name="sortBy" onchange="updateFilter('sortBy', this.value)">
                                <option value="newest" <%= sortBy === 'newest' ? 'selected' : '' %>>Newest First</option>
                                <option value="price-low" <%= sortBy === 'price-low' ? 'selected' : '' %>>Price: Low to High</option>
                                <option value="price-high" <%= sortBy === 'price-high' ? 'selected' : '' %>>Price: High to Low</option>
                                <option value="name-asc" <%= sortBy === 'name-asc' ? 'selected' : '' %>>Name: A to Z</option>
                                <option value="name-desc" <%= sortBy === 'name-desc' ? 'selected' : '' %>>Name: Z to A</option>
                                <option value="rating-high" <%= sortBy === 'rating-high' ? 'selected' : '' %>>Highest Rated</option>
                                <option value="popular" <%= sortBy === 'popular' ? 'selected' : '' %>>Most Popular</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Products Grid -->
                    <div class="row">
                        <% if (products && products.length > 0) { %>
                            <% products.forEach(product => { %>
                                <div onclick="goToProductPage(`<%= product._id %>`)" class="col-lg-4 col-md-4 col-sm-6 col-6 mix <%= product.isFeatured ? 'featured' : 'hot-sales' %>">
            <div class="product__item">
                <div class="product__item__pic set-bg" data-setbg="<%= product.images[0] || 'img/product/default.jpg' %>">
                    <% if (product.isNew) { %>
                        <span class="label">New</span>
                    <% } %>
                    <% if (product.isFeatured) { %>
                        <span class="label">Featured</span>
                    <% } %>
                    <ul class="product__hover">
                        <li><a href="#"><img src="/img/icon/heart.png" alt=""></a></li>
                        <li><a href="#"><img src="/img/icon/compare.png" alt=""> <span>Compare</span></a></li>
                        <li><a href="/user/products/<%= product._id %>"><img src="/img/icon/search.png" alt=""></a></li>
                    </ul>
                </div>
                <div class="product__item__text">
                    <h6><%= product.name %></h6>
                    <a href="#" class="add-cart">+ Add To Cart</a>
                    <div class="rating">
                        <% for (let i = 0; i < 5; i++) { %>
                            <i class="fa fa-star-o"></i>
                        <% } %>
                    </div>
               <div class="price-info">
                   <% if (product.salePrice > 0 && product.salePrice < product.regularPrice) { %>
                    <span class="sale-price">₹<%= product.salePrice.toFixed(2) %></span>
                    <% } %>
                    <span class="regular-price">₹<%= product.regularPrice.toFixed(2) %></span>
                    </div> 
                                        <div class="stat-item">
                      <span class="stat-label">Stock</span>
                      <span class="stock-badge <%= product.stock <= 10 ? 'low-stock' : product.stock <= 0 ? 'out-of-stock' : 'in-stock' %>">
                        <%= product.stock %>
                      </span>
                    </div>
                    <div class="product__color__select">
                        <label for="pc-1-<%= product._id %>">
                            <input type="radio" id="pc-1-<%= product._id %>">
                        </label>
                        <label class="active black" for="pc-2-<%= product._id %>">
                            <input type="radio" id="pc-2-<%= product._id %>">
                        </label>
                        <label class="grey" for="pc-3-<%= product._id %>">
                            <input type="radio" id="pc-3-<%= product._id %>">
                        </label>
                    </div>
                </div>
            </div>
        </div>
                            <% }) %>
                        <% } else { %>
                            <div class="col-lg-12">
                                <div class="text-center py-5">
                                    <h4>No products found</h4>
                                    <p>Try adjusting your filters or search terms.</p>
                                    <a href="/user/products/shop" class="primary-btn">View All Products</a>
                                </div>
                            </div>
                        <% } %>
                    </div>
                    
                    <% if (totalPages > 1) { %>
                        <div class="pagination-wrapper">
                            <ul class="pagination">
                                <% if (currentPage > 1) { %>
                                    <li><a href="<%= buildPaginationUrl(currentPage - 1) %>">&laquo;</a></li>
                                <% } %>
                                
                                <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                                    <li class="<%= i === currentPage ? 'active' : '' %>">
                                        <a href="<%= buildPaginationUrl(i) %>"><%= i %></a>
                                    </li>
                                <% } %>
                                
                                <% if (currentPage < totalPages) { %>
                                    <li><a href="<%= buildPaginationUrl(currentPage + 1) %>">&raquo;</a></li>
                                <% } %>
                            </ul>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
    
    <div class="mobile-filter-overlay" onclick="toggleMobileFilter()"></div>
    <div class="mobile-filter-sidebar">
        <button class="close-mobile-filter" onclick="toggleMobileFilter()">&times;</button>
        <h5>Filters</h5>
        
        <div class="filter-group">
            <h6 class="filter-title">Price Range</h6>
            <div class="price-range">
                <label>
                    <input type="radio" name="mobilePriceRange" value="" <%= !priceRange ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    All Prices
                </label>
                <label>
                    <input type="radio" name="mobilePriceRange" value="0-50" <%= priceRange === '0-50' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    $0 - $50
                </label>
                <label>
                    <input type="radio" name="mobilePriceRange" value="50-100" <%= priceRange === '50-100' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    $50 - $100
                </label>
                <label>
                    <input type="radio" name="mobilePriceRange" value="100-150" <%= priceRange === '100-150' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    $100 - $150
                </label>
                <label>
                    <input type="radio" name="mobilePriceRange" value="150-200" <%= priceRange === '150-200' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    $150 - $200
                </label>
                <label>
                    <input type="radio" name="mobilePriceRange" value="200-plus" <%= priceRange === '200-plus' ? 'checked' : '' %> onchange="updateFilter('priceRange', this.value)">
                    $200+
                </label>
            </div>
        </div>
        
        <div class="filter-group">
            <h6 class="filter-title">Size</h6>
            <div class="size-options">
                <% sizes.forEach(sizeItem => { %>
                    <a href="#" class="size-btn <%= size === sizeItem ? 'active' : '' %>" 
                       onclick="updateFilter('size', '<%= sizeItem %>')">
                        <%= sizeItem %>
                    </a>
                <% }) %>
            </div>
        </div>
        
        <!-- Mobile Rating Filter -->
        <div class="filter-group">
            <h6 class="filter-title">Rating</h6>
            <div class="rating-options">
                <a href="#" class="rating-btn <%= rating === '4' ? 'active' : '' %>" 
                   onclick="updateFilter('rating', '4')">
                    4+ Stars
                </a>
                <a href="#" class="rating-btn <%= rating === '3' ? 'active' : '' %>" 
                   onclick="updateFilter('rating', '3')">
                    3+ Stars
                </a>
                <a href="#" class="rating-btn <%= rating === '2' ? 'active' : '' %>" 
                   onclick="updateFilter('rating', '2')">
                    2+ Stars
                </a>
            </div>
        </div>
        
        <div class="filter-group">
            <a href="/shop" class="btn btn-outline-secondary btn-sm">Clear All Filters</a>
        </div>
    </div>
    

    
    <script>
        function updateFilter(filterName, value) {
            const url = new URL(window.location);
            
            if (value === '' || value === null) {
                url.searchParams.delete(filterName);
            } else {
                url.searchParams.set(filterName, value);
            }
            
            if (filterName !== 'page') {
                url.searchParams.set('page', '1');
            }
            
            window.location.href = url.toString();
        }
        
        function toggleMobileFilter() {
            const overlay = document.querySelector('.mobile-filter-overlay');
            const sidebar = document.querySelector('.mobile-filter-sidebar');
            
            if (sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
                overlay.style.display = 'none';
            } else {
                sidebar.classList.add('active');
                overlay.style.display = 'block';
            }
        }


        function goToProductPage (id) {
            window.location.href = `/user/products/${id}`
        }
        
    </script>
</body>
</html>

<%
function buildPaginationUrl(page) {
    const params = new URLSearchParams();
    if (search) params.set('search', search);
    if (category) params.set('category', category);
    if (brand) params.set('brand', brand);
    if (priceRange) params.set('priceRange', priceRange);
    if (size) params.set('size', size);
    if (color) params.set('color', color);
    if (rating) params.set('rating', rating);
    if (sortBy) params.set('sortBy', sortBy);
    params.set('page', page);
    return '/shop?' + params.toString();
}
%>
